//define a resolucao virtual da tela
SetErrorMode(2)
SetVirtualResolution ( 400, 320 )
SetOrientationAllowed( 1, 1, 1, 1 ) 
SetSyncRate( 300, 0 )

//Fazendo Menu do Jogo

	Global Telas = 0
	
	//Bloco de variaveis
	
	posX as float = 190
	posY as float = 240
	Direita as float = 1
	Esquerda as float = 0
	Global pers 
	Vidas as integer = 5
	Score as integer = -100
	Global cenario
		
	posBX as float = 0
	posBY as float = 0
	tiro as integer = 0
	Global Bala 
	Global som 
	
	//Gangster 1 
	posGX1 as float = 0
	posGY1 as float = 240
	direction1 as integer = 1
	vel1 as float = 0.25
	escolha1 as integer = 0
	Global gang1
	
	//Gangster 1 
	posGX2 as float = 400
	posGY2 as float = 240
	direction2 as integer = -1
	vel2 as float = 0.15
	escolha2 as integer = 0
	Global gang2 
	

	// Mostra o fundo e musica
	
	Function Telajogo()
		
	cenario = CreateSprite ( LoadImage ( "cenario.png" ) )
	LoadMusicOGG(1, "musica2.ogg")
	PlayMusicOGG(1, 1)
	LoadMusicOGG(2, "gameover.ogg")	
		
	
	//Sprite bala
	
	Bala = LoadImage("bala.png")
	CreateSprite(Bala)
	SetSpriteSize(Bala, 8, 4)
	SetSpritePosition(Bala, 1000, 1000)
	SetSpriteShape(Bala, 2)
	som = LoadSound("arma.wav")
	
	//Movimento jogador	

	pers = CreateSprite(pers)
	
	AddSpriteAnimationFrame(pers, LoadImage("perscorre1.png"))
	AddSpriteAnimationFrame(pers, LoadImage("perscorre3.png"))
	AddSpriteAnimationFrame(pers, LoadImage("perscorre4.png"))
	AddSpriteAnimationFrame(pers, LoadImage("perscorre5.png"))
	SetSpriteShape(pers, 2)
	
	PlaySprite ( pers, 4, 1, 1, 4)
	
	//Movimento gangster 1

	gang1 = CreateSprite(gang1)
	
	AddSpriteAnimationFrame(gang1, LoadImage("gangstercorre0.png"))
	AddSpriteAnimationFrame(gang1, LoadImage("gangstercorre0.1.png"))
	AddSpriteAnimationFrame(gang1, LoadImage("gangstercorre0.2.png"))
	AddSpriteAnimationFrame(gang1, LoadImage("gangstercorre0.3.png"))
	SetSpriteShape(gang1, 2)

	PlaySprite ( gang1, 4, 1, 1, 4)
	//SetSpritePosition(gang1, posGX1, posGY1)
	
	//Movimento gangster 2 
	
	gang2 = CreateSprite(gang2)
	
	AddSpriteAnimationFrame(gang2, LoadImage("gangstercorre0.png"))
	AddSpriteAnimationFrame(gang2, LoadImage("gangstercorre0.1.png"))
	AddSpriteAnimationFrame(gang2, LoadImage("gangstercorre0.2.png"))
	AddSpriteAnimationFrame(gang2, LoadImage("gangstercorre0.3.png"))
	SetSpriteShape(gang2, 2)
	
	SetSpriteFlip( gang2, 180, 0)
	PlaySprite ( gang2, 4, 1, 1, 4)
	//SetSpritePosition(gang2, posGX2, posGY2)
	
	
	endfunction
	
	Function Menu()
		
		fundo = CreateSprite( LoadImage("menu.png"))
		
	if GetRawKeyPressed(13) = 1
		Telas = 1
		DeleteSprite(fundo)
		Telajogo()
	endif
	endfunction
	
	Function Fim()
		fim = CreateSprite ( LoadImage ( "fim.png" ) )
		DeleteSprite(cenario)
	endfunction
		
		
do
		
	if Telas = 0
			
			Menu()
			
	endif
		
	if Telas = 1	
	
	PrintC("Pontuação:")
	Print(Score)
	PrintC("Vidas:")
	Print(Vidas)
	
	//Dando o tiro
	
	if GetRawKeyPressed(68) = 1
		
		if Lado = 0
		SetSpriteFlip( Bala, 0, 0)
		Esquerda = 0
		Direita = 1
		endif
		
	elseif GetRawKeyPressed(65) = 1
	
		if Lado = 0
		SetSpriteFlip(Bala, 180, 0)
		Esquerda = 1
		Direita = 0
		endif
		
	endif
	
 	if GetPointerPressed()=1 and tiro = 0 and Lado = 0
		PlaySound(som)
		tiro = 1
		Lado = 1
		posBX = GetSpriteX(pers) 
		posBY = GetSpriteY(pers) + GetSpriteWidth(pers)/2-GetSpriteWidth(Bala)/2
	endif
	
	if tiro = 1 and Direita = 1 and Lado = 1
		posBX = posBX + 4.5
		elseif tiro = 1 and Esquerda = 1 and Lado = 1
		posBX = posBX - 4.5
	endif
	
	if posBX < -GetSpriteHeight(Bala) - 5
		SetSpritePosition(Bala, 1000, 1000)
		tiro = 0
		Lado = 0
	endif
	
	if posBX > GetVirtualWidth() - GetSpriteWidth(pers) + 75
		SetSpritePosition(Bala, 1000, 1000)
		tiro = 0
		Lado = 0
	endif
	SetSpritePosition(Bala, posBX, posBY)
	
	//Mexe personagem
	
	// Mexe a Sprite pra direita
	if GetRawKeyState(68) = 1 
		SetSpriteFlip( pers, 0, 0)
		posX = posX + 2
			if Lado = 0
			SetSpriteFlip( Bala, 0, 0)
			Esquerda = 0
			Direita = 1
			endif
		
	
	// Mexe a Sprite pra esquerda
	elseif GetRawKeyState (65) = 1
		SetSpriteFlip( pers, 180, 0)
		posX = posX - 2
			if Lado = 0
			SetSpriteFlip( Bala, 180, 0)
			Esquerda = 1
			Direita = 0
			endif
		
		
	  if ( GetSpritePlaying ( pers ) = 0 )
	  PlaySprite ( pers, 4, 1, 1, 4)
	  endif
  endif
  
  //Delimitando a borda do personagem
  
	if posX < 0
	   posX = 0
	endif
	if posX > GetVirtualWidth() - GetSpriteWidth(pers)
	   posX = GetVirtualWidth() - GetSpriteWidth(pers)
	endif
	
  //Trajetória gangster 1
  
  posGX1 = posGX1 + (vel1*direction1) 
  
    if posGX1 > GetVirtualWidth() - GetSpriteWidth(pers) + 30
		posGX1 = GetVirtualWidth() - GetSpriteWidth(pers)
		SetSpriteFlip( gang1, 180, 0)
		direction1 = -1
	endif
	
	if posGX1 < 0
	   posGX1 = 0
	   SetSpriteFlip( gang1, 0, 0)
	   direction1 = 1
	endif
	
  // Trajetória gangster 2 
  
  posGX2 = posGX2 + (vel2*direction2) 
  
	if posGX2 > GetVirtualWidth() - GetSpriteWidth(pers) + 30
		posGX2 = GetVirtualWidth() - GetSpriteWidth(pers)
		SetSpriteFlip( gang2, 180, 0)
		direction2 = -1
	endif
	
	if posGX2 < 0
	   posGX2 = 0
	   SetSpriteFlip( gang2, 0, 0)
	   direction2 = 1
	endif
	
	//Colisão entre o personagem e gangster 1
	
	if GetSpriteCollision(pers, gang1)
		
		escolha1 = Random(1,2)
		
		if escolha1 = 1
		posGX1 = 0
		endif
		
		if escolha1 = 2
		posGX1 = 400
		endif
		
		Vidas = Vidas - 1
	endif
	
	//Colisão entre personagem e gangster 2
	
	if GetSpriteCollision(pers, gang2)
		
		escolha2 = Random(1,2)
		
		if escolha2 = 1
		posGX2 = 0
		endif
		
		if escolha2 = 2
		posGX2 = 400
		endif
		
		Vidas = Vidas - 1
	endif
	
	//Colisão Bala e gangster 1
	
	if GetSpriteCollision(Bala, gang1)
		
		escolha1 = Random(1,2)
		
		if escolha1 = 1
		posGX1 = 0
		vel1 = vel1 + 0.35
		endif
		
		if escolha1 = 2
		posGX1 = 400
		vel1 = vel1 + 0.35
		endif
		
		if vel1 > 3
		vel1 = 2
	endif
	
	Score = Score + 50
	endif
	
	//Colisão Bala e gangster 2
	
	if GetSpriteCollision(Bala, gang2)
		
		SetRandomSeed(32)
		escolha2 =  Random(1,2)
		
		if escolha2 = 1
		posGX2 = 0
		vel2 = vel2 + 0.25
		endif
		
		if escolha2 = 2
		posGX2 = 400
		vel2 = vel2 + 0.25
		endif
		
		if vel2 > 3.75
		vel2 = 1.75
		endif
		
	Score = Score + 50
	
	endif	
		
	
	SetSpritePosition(pers, posX, posY)
	SetSpritePosition(Bala, posBX, posBY)
	SetSpritePosition(gang1, posGX1, posGY1)
	SetSpritePosition(gang2, posGX2, posGY2)
	
	if Vidas = 0
		DeleteMusicOGG(1)
		PlayMusicOGG(2, 0)
		Sleep(300)	
		Telas = 3
	endif
	
	endif
	
	if Telas = 3
		Fim()	
		SetPrintSize(50)
		SetPrintFont(0)
		Print("")
		PrintC("Pontuação:")
		Print("")
		Print("")
		PrintC(Score)
		
	
	
	endif

 sync ( )

loop
